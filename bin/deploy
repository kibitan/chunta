#!/bin/bash
set -eu -o pipefail
ask() {
  printf "$* [y/n] "
  local answer
  read answer

  case $answer in
    "yes" ) return 0 ;;
    "y" )   return 0 ;;
    * )     return 1 ;;
  esac
}

if ask "git push?"; then
  git push
fi

ask "deploy?"

set -vx


dir="$(cd "$(dirname "${BASH_SOURCE:-${(%):-%N}}")"; pwd)"

scp .envrc family:/var/www/chunta/
ssh family <<-EOS
  cd /var/www/chunta
  git pull
  crontab < .crontab
  bin/chunta restart
EOS
